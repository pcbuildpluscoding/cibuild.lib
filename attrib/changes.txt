huge refactoring for proving new configuration as code design
